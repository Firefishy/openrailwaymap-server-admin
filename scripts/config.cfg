# SPDX-License-Identifier: GPL-3.0-or-later
# OpenRailwayMap Copyright (C) 2019 Michael Reichert
#
# This file is part of the OpenRailwayMap server admin tools repository
# (https://github.com/OpenRailwayMap/server-admin).
#
# This program is free software: you can redistribute it and/or modify it under the terms of the
# GNU General Public License as published by the Free Software Foundation, version 3.
#
# This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without
# even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program. If not, see <http://www.gnu.org/licenses/>.
#
# Configuration file for tile database and routing upgrade


# Paths for OSM Data
# ------------------
# Directory for OSM planet and its filtered version
OSM_DIR=/nvme/data/planet
# Path to planet dump file
PLANET_FILE=$OSM_DIR/planet-latest.osm.pbf
# Temporary directory for Pyosmium (downloaded diffs)
PLANET_UPDATE_TMP=$OSM_DIR/tmp/
# Path to filetered planet dump
PLANET_FILTERED=$OSM_DIR/planet-railway.osm.pbf
# Path to last version filetered planet dump
PLANET_FILTERED_OLD=$OSM_DIR/old-planet-railway.osm.pbf
# Path to derived diff file with railway changes
DERIVED_DIFF=$OSM_DIR/railway_updates.osc.gz

# Path to timestamp file for website
TIMESTAMP_PATH=/nvme/data/timestamp.txt

# Binaries
# --------
PYOSMIUM_UP_TO_DATE=pyosmium-up-to-date
OSMIUM=osmium
OSM2PGSQL=osm2pgsql
TILE_ID_TO_META=/opt/openrailwaymap-server-scripts/tile_id_to_meta.py

# Enable/Disable Steps
# --------------------
# Enable tile rendering
TILE_RENDERING=1
# Enable routing
ROUTING=0

# Sleep duration until next update
SLEEP_SECONDS=1800s

# Osmium filter expression
OSMIUM_FILTER_EXPR="nwr/railway r/route=train r/route=light_rail r/route=tram r/route=subway nwr/disused:railway nwr/abandoned:railway nwr/razed:railway nwr/construction:railway nwr/proposed:railway"

# Tileserver related settings
# ---------------------------
# Database name
DATABASE_NAME=gis
# Osm2pgsql style file
OSM2PGSQL_STYLE=/opt/OpenRailwayMap-CartoCSS/setup/openstreetmap-carto.style
# Osm2pgsql tag transform file (Lua)
OSM2PGSQL_LUA=/opt/OpenRailwayMap-CartoCSS/setup/openstreetmap-carto.lua
# Flatnodes file path (about 50 GB large file which should be located on a SSD drive)
# Do not set this variable (comment it out) if you want to store node locations in the
# planet_osm_nodes table. This is slower for a full planet import (both filtered and not filtered)
OSM2PGSQL_FLATNODES=/nvme/data/flatnodes/flat.nodes
# Zoom levels to expire tiles at
EXPIRE_TILES_ZOOM=12:19
# Path for tile expiry output file for Osm2pgsql
EXPIRE_OUTPUT=/nvme/data/tileupdate/expiry.log
# Metatile directory
METATILE_ROOT_DIR=/var/lib/tirex/tiles/
# Map names used by Tirex. They must match the subdirectories of $METATILE_ROOT_DIR. If you use
# multiple maps, separate them by comma
TIREX_MAPS="standard,maxspeed,signals"
# Tirex job priority for re-rendering tiles when their data has changed
TIRES_RERENDER_PRIO=25
